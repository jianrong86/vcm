{% extends "base.html" %}
{% load staticfiles %}

{% block css %}

{% endblock %}

{% block content %}

<div class="box box-danger">
    <form class="form-horizontal" id="addForm" method="post">
        <input type="hidden" name='sw_id' value="{{ ver.id }}"/>
{#        <input type="hidden" name='sw_id' value="{{ ver.id }}"/>#}
        <div class="box-body">
            <fieldset>
                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label">Weekly:</label>
                    <div class="col-sm-3">
                        <input class="form-control" maxlength="20" name="weekly" type="text" value="{{ ver.weekly }}"/>
                    </div>

                   <label class="col-sm-2 control-label" for="id_project_name">Project&nbsp;name:</label>
                    <div class="col-sm-3">
                        <input class="form-control" id="id_project_name" maxlength="20" name="project_name" type="text" value="{{ ver.project_name }}" required />
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label" for="id_customer_name">Customer&nbsp;name:</label>
                    <div class="col-sm-3">
                        <input class="form-control" id="id_customer_name" maxlength="20" name="customer_name" type="text" value="{{ ver.customer_name }}" required />
                    </div>

                    <label class="col-sm-2 control-label" for="id_customer_id">Customer&nbsp;id:</label>
                    <div class="col-sm-3">
                        <input class="form-control" id="id_customer_id" maxlength="10" name="customer_id" type="text" value="{{ ver.customer_id }}" required />
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label">Build&nbsp;Type:</label>
                    <div class="col-sm-3">
                        <select class="form-control col-sm-3" id="selectBuildType" style="width:100%;" name="build_type">
                            <option value={{ ver.build_type }}>{{ ver.get_build_type_display }}</option>
                            {% for build_type in build_type_list %}
                            <option value={{ build_type.item }}>{{ build_type.value }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="form-group has-feedback" id="rebuildBlock">
                    <label class="col-sm-2 control-label">Rebuild&nbsp;reason:</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" cols="40" name="rebuild_reason" rows="10">{{ ver.rebuild_reason }}</textarea>
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label">Release&nbsp;Type:</label>
                    <div class="col-sm-3">
                        <select class="form-control col-sm-3" id="selectReleaseType" style="width:100%;" name="release_type">
                            <option value={{ ver.release_type }}>{{ ver.get_release_type_display }}</option>
                            {% for release_type in release_type_list %}
                            <option value={{ release_type.item }}>{{ release_type.value }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="form-group has-feedback" id="reReleaseBlock">
                    <label class="col-sm-2 control-label">Re-release&nbsp;reason:</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" cols="40" name="re_release_reason" rows="10">{{ ver.re_release_reason }}</textarea>
                    </div>
                </div>



                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label">Firmware&nbsp;develop:</label>
                    <div class="col-sm-3">
                        <input class="form-control" id="id_firmware_develop" maxlength="254" name="firmware_develop" type="email" value="{{ ver.firmware_develop }}" />
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label">Webui&nbsp;develop:</label>
                    <div class="col-sm-3">
                        <input class="form-control" id="id_webui_develop" maxlength="254" name="webui_develop" type="email" value="{{ ver.webui_develop }}"/>
                    </div>

                    <label class="col-sm-2 control-label">Compiler:</label>
                    <div class="col-sm-3">
                        <input class="form-control" id="id_compiler" maxlength="254" name="compiler" type="email" value="{{ ver.compiler }}"/>
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label">Verifier:</label>
                    <div class="col-sm-3">
                        <input class="form-control" id="id_verifier" maxlength="254" name="verifier" type="email" value="{{ ver.verifier }}"/>
                    </div>

                    <label class="col-sm-2 control-label">VPM:</label>
                    <div class="col-sm-3">
                        <input class="form-control" id="id_vpm" maxlength="254" name="vpm" type="email" value="{{ ver.vpm }}"/>
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label">Software&nbsp;name:</label>
                    <div class="col-sm-3">
                        <input class="form-control" id="id_software_version" maxlength="256" name="software_version" type="text" value="{{ ver.software_version }}"/>
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label">Software&nbsp;path:</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" cols="40" id="id_software_path" name="software_path" rows="10">{{ ver.software_path }}</textarea>
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label">Modification:</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" cols="40" id="id_modification" name="modification" rows="10">{{ ver.modification }}</textarea>
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <div>
                        <label class="col-sm-2 control-label">Plan&nbsp;Release&nbsp;Date:</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control pull-right form_datetime" name="plan_release_date" value="{{ ver.plan_release_date |date:'Y-m-d H:m:s'}}"/>
                        </div>
                    </div>

                    <div>
                        <label class="col-sm-2 control-label">Actual&nbsp;Release&nbsp;Date:</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control pull-right form_datetime" name="actual_release_date" value="{{ ver.plan_release_date |date:'Y-m-d H:m:s'}}"/>
                        </div>
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label">Release&nbsp;delay&nbsp;reason:</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" cols="40" id="id_release_delay_reason" name="release_delay_reason" rows="10">{{ ver.release_delay_reason }}</textarea>
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label">Self&nbsp;test&nbsp;result:</label>
{#                    <div class="col-sm-3">#}
{#                        <input class="form-control" id="id_self_test_result" maxlength="10" name="self_test_result" type="text" value="{{ ver.self_test_result }}" />#}
{#                    </div>#}
                    <div class="col-sm-3">
                        <select class="form-control" style="width:100%;" name="self_test_result" id="id_self_test_result" type="text" >
{#                            {% if ver.val_verify_result == "0" %}#}
                                <option value={{ ver.val_verify_result }}>{{ ver.get_self_test_result_display }}</option>
                                <option></option>
                                {% for result in test_result_list %}
                                <option value="{{ result.item }}">{{ result.value }}</option>
                                {% endfor %}
{#                                <option value=0>PASS</option>#}
{#                                <option value=1>FAIL</option>#}
{#                            {% else %}#}
{#                                <option value=1>FAIL</option>#}
{#                                <option value=0>PASS</option>#}
{#                            {% endif %}#}
                        </select>
                    </div>
                </div>

                <div class="form-group has-feedback" id="selfTestReasonBlock">
                    <label class="col-sm-2 control-label">Self&nbsp;test&nbsp;fail&nbsp;reason:</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" cols="40" id="id_self_test_fail_reason" name="self_test_fail_reason" rows="10">{{ ver.self_test_fail_reason }}</textarea>
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label">Val&nbsp;verify&nbsp;result:</label>
{#                    <div class="col-sm-3">#}
{#                        <input class="form-control" id="id_val_verify_result" maxlength="10" name="val_verify_result" type="text" value="{{ ver.val_verify_result }}"/>#}
{#                    </div>#}
                    <div class="col-sm-3">
                        <select class="form-control" style="width:100%;" name="val_verify_result" id="id_val_verify_result" type="text" >
                            <option value={{ ver.val_verify_result }}>{{ ver.get_val_verify_result_display }}</option>
                            <option></option>
                            {% for result in test_result_list %}
                                <option value="{{ result.item }}">{{ result.value }}</option>
                            {% endfor %}

                        </select>
                    </div>
                </div>

                <div class="form-group has-feedback" id="valVerifyResultBlock">
                    <label class="col-sm-2 control-label">Val&nbsp;verify&nbsp;fail&nbsp;reason:</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" cols="40" id="id_val_verify_fail_reason" name="val_verify_fail_reason" rows="10">{{ ver.val_verify_fail_reason }}</textarea>
                    </div>
                </div>

                <div class="form-group has-feedback">
                    <label class="col-sm-2 control-label" for="id_status">Status:</label>
                    <div class="col-sm-3">
                        <select class="form-control" style="width:100%;" name="status" id="id_status">
                            {% if ver.status == "0" %}
                                <option value=0>OPEN</option>
                                <option value=1>FINISH</option>
                            {% else %}
                                <option value=1>FINISH</option>
                                <option value=0>OPEN</option>
                            {% endif %}
{#                            <option value=0>OPEN</option>#}
{#                            <option value=1>FINISH</option>#}
                        </select>
                    </div>
                </div>
            </fieldset>
        </div>
        <div class="box-footer">
            <div class="row span7 text-center">
                <button type="button" id="btnSave" class="btn btn-success margin-right">Save</button>
                <button type="button" id="btnCancel" class="btn btn-success margin-right">Cancel</button>
            </div>
        </div>
    </form>
</div>

{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
    $("#btnSave").click(function () {
        var data = $("#addForm").serialize();
        $.ajax({
            type : $("#addForm").attr('method'),
            url : "{% url 'software-update' %}",
            data : data,
            cache : false,
            success : function(msg) {
                if (msg.status == 'success') {
                    layer.alert('success！', {icon: 1},function(index){
					    parent.layer.closeAll(); //关闭所有弹窗
                    });
                }else{
                    layer.alert('fail！\n' + msg.status, {icon: 1},function(index){
					    parent.layer.closeAll(); //关闭所有弹窗
                    });
                }
                return;

            },
            error: function(msg) {
                layer.alert(msg);
            }

        });
    });

    /*点取消刷新新页面*/
    $("#btnCancel").click(function () {
	    window.location.reload();

    })

    $(".form_datetime").datetimepicker({
            language:  'zh',
{#            minView: 'month', //选择范围知道日期，不选择时分#}
            //weekStart: 1,
            //todayBtn:  1,
            autoclose: 1,
            todayHighlight: 1,
            //startView: 2,
            forceParse: 0,
            showMeridian: 1,
{#            format: 'yyyy-mm-dd'#}
        }).on('changeDate', function (ev) {
            $(this).datetimepicker('hide');
    });

    $("#selectBuildType").change(function () {
{#        console.log($("option:selected", this).val());#}
        if($("option:selected", this).val()==1){
            $("#rebuildBlock").show();
        }else{
            $("#rebuildBlock").hide();
        }
    });

    $("#selectReleaseType").change(function () {
        console.log($("option:selected", this).val());
        if($("option:selected", this).val()==1){
            $("#reReleaseBlock").show();
        }else{
            $("#reReleaseBlock").hide();
        }
    });

    $("#selectSelfTest").change(function () {
        console.log($("option:selected", this).val());
        if($("option:selected", this).val()==1){
            $("#selfTestReasonBlock").show();
        }else{
            $("#selfTestReasonBlock").hide();
        }
    });

    $("#selectValVerifyResult").change(function () {
        console.log($("option:selected", this).val());
        if($("option:selected", this).val()==1){
            $("#valVerifyResultBlock").show();
        }else{
            $("#valVerifyResultBlock").hide();
        }
    });

{#    $("#rebuildBlock").hide();#}
{#    $("#reReleaseBlock").hide();#}
{#    $("#selfTestReasonBlock").hide();#}
{#    $("#valVerifyResultBlock").hide();#}
    </script>
{% endblock %}